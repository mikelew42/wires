var TestFramework = require("../test/framework");
var test = TestFramework.test;
var assert = console.assert.bind(console);
var is = require("../is");
var $ = require("jquery");
var View = require("./View");
var Div = require("./Div");
View.Page = require("./Page");
View.Pager = require("./Pager");
var Page = View.Page;
var Pager = View.Pager;
// require("./even-more.less");

var logger = require("log42");
var log = logger();

var xtest = function(){};

$(function(){

var SimplePager = View.extend({
	name: "SimplePager",
	addClass: "simple-pager",
	init: function(){
		this.chain = [];
	},
	content: function(){
		this.append(this.name);
	},
	to: function(view){
		view.hide();
		view.appendTo(this.$el);

		// store the last page
		if (this.last)
			this.chain.push(this.last);

		if (this.current){
			this.current.hide();
			this.last = this.current;
		}
		
		view.show();
		this.current = view;
	},
	back: function(){
		if (this.current)
			this.current.hide();
		
		if (this.last)
			this.last.show();

		this.current = this.last;
		this.last = this.chain.pop();
	}
});

var Flex = View.AutoSub.extend({
	css: {
		display: "flex"
	},
	Left: View.AutoSub.extend(),
	Right: View.AutoSub.extend(),
	content: function(){
		this.left.render();
		this.right.render();
	}
});

test("SimplePager", function(){

	var pager = SimplePager({
		name: "pager",
		autoRender: false,
		css: {
			border: "2px solid black",
			height: "100%"
		},
		a: View(function(){
			this.append("a");
		}),
		b: View(function(){
			this.append("b")
		})
	});


	for (var i = 1; i < 11; i++){
		pager["v"+i] = View(function(){
			this.append("v"+i);
			View({
				tag: "button",
				content: "back",
				click: [function(){
					pager.back();
				}]
			})
		});
	}

	var createButton = function(pager, name){
		View({
			// tag: "button",
			css: { padding: "5px 10px", display: "block", cursor: "pointer", background: "#eee" },
			content: name,
			click: [function(){
				pager.to(pager[name]);
			}]
		});
	};


	Flex({
		left: function(){
			for (var i in pager){
				if (pager[i] instanceof View){
					if (i === "base" || i === "proto")
						continue;
					pager[i].hide();
					createButton(pager, i);
				}
			}
		},
		right: function(){
			this.css("flex-grow", 1);
			pager.render()
		}
	});
});



test("Pages", function(){

	// console.log(Page.prototype.SubPage);

	Pager(function(){
		this.to(Page({
			name: "test",
			pager: this,
			size: 5,
			depth: 5
		}).render());
	})
});

});