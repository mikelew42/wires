var TestFramework = require("test/framework");
var test = TestFramework.test;
var is = require("is");
var $ = require("jquery");
var assert = console.assert.bind(console);

var logger = require("log42/logger2");

// var Mod1 = require("mod42/Mod1");
// var Mod2 = require("mod42/Mod2");


$(function(){

test("logger", function(){

	test("auto", function(){
		var log = logger();
		log("auto defaults to off");
	});

	test("on", function(){
		var log = logger(true);
		log("use true to turn it on");
	});

	test("off", function(){
		var log = logger(false);
		log("will not log, even if global logging is turned on");
		log("why? its not meant to stay off forever - its so you can turn it back on easily");
	});

	test("default off", function(){
		var log = logger();

		console.group("assert: empty group");
		log("shouldn't show");
		log.error("uh oh");
		log("hello world");
		log.trace("here's a trace");
		log.debug("here's a debug");
		log.info("here's some info");
		log.warn("here's a warning");
		log.error("here's an error");
		console.groupEnd();

		log.on(function(log){
			log.g("assert: sample of all logs", function(){
				log("hello world");
				log.trace("here's a trace");
				log.debug("here's a debug");
				log.info("here's some info");
				log.warn("here's a warning");
				log.error("here's an error");
			});
		});

		log("goodbye world");
		log.error("uh oh - this shouldn't appear");

		log = logger(true);

		log("hello again");
		log.warn("warning!");

		log.g("nested scope", function(){
			console.log("damnit");
			var log = logger(false);

			log("just turned off for this function scope");
			log.error("shouldn't show");
			log.info("this is very bad, you shouldn't see me");
		});

		log("hello again!");
		log.info("now that we've exited the function scope, these should be turned on again");

		test("tests are different from log groups", function(){
			log("I think I'm turned on");
			log("This should have its own 'nested scope' log group inside");
		});

		test("no, that was the first child... now we should have a second run", function(){
			log("Now we should have a second run...");
		});
	});	

	test("modular", function(){
		console.log("starting modular");
		var obj = {};
		logger.install(obj);

		console.log(obj.log.enabled);

		test("basic", function(){
			console.group("basic");
			console.log(obj.log.enabled);
			obj.log("yo");

			console.log("turning obj.log = true");
			obj.log = true;

			obj.log("now we're on");
			console.groupEnd();
		});

		test("override", function(){
			console.log("starting override");
			console.log(obj.log.enabled);
			var log = logger();

			obj.log("wtf");
			obj.log.error("nope");

			log.on(function(){
				obj.log("I should be on");
			});

			obj.log.error("nope");
		});

	});

});

test("wtf", function(){
	var obj = {};
	obj.id = this.runCount;
	console.log(obj.id);

	test("and then", function(){
		console.log("and then");
		console.log(obj.id);
	});

	console.log(obj.id);

	test("and another", function(){
		console.log("and another");
		console.log(obj.id);
	});

	console.log(obj.id);
});

test("omg", function(){
	var root = function(sub){
		var obj = {};
		obj.id = 0;
		
		if (sub === 1)
			obj.id = 1;

		console.log(obj.id);

		if (sub === 1){
			(function(){
				console.log(obj.id);
			})();
		}

		if (sub === 2){
			(function(){
				console.log(obj.id);
			})();
		}
	};

	root(1);
	root(2);
});

});